<% layout("/layouts/boilerplate") %>
<div class="row">
    <div class="col-8 offset-2 mt-3">
        <br><br>
        <h3>Update <%= club.title %></h3>
        <form method="post" action="/clubs/<%= club._id %>?_method=PUT" enctype="multipart/form-data" class="needs-validation" novalidate>
            <div class="mb-3">
                <label for="title" class="form-label">Title</label>
                <input type="text" name="club[title]" id="title" value="<%= club.title %>"class="form-control" placeholder="Add your club title"
                    required>
                <div class="valid-feedback">Title looks good!</div>
            </div>
            <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <textarea name="club[description]" id="description" placeholder="Enter description..."
                    class="form-control" required><%= club.description %></textarea>
                <div class="invalid-feedback">Please enter a description.</div>
            </div>
            <div class="row">
                <div class="mb-3 ">
                    <div class="heading-club">
                        <div class="heading-club-image" style="background-image: url('<%= club.image.url %>');">
                            <h2 >
                                <%= club.title %>
                            </h2>
                        </div>
                    </div>
                    <label for="image" class="form-label">Update Club Image</label>
                    <input type="file" name="club[image]" id="image" class="form-control">
                </div>
                <div class="mb-3">
                    <label for="admins" class="form-label">Add Admins Email</label>
                    <input type="email" name="club[admins][0][email]" value="<%= club.admins[0].email %>" id="admin-email-0" class="form-control" placeholder="Admin Email">
                </div>
                <hr>
            <h5>About Section</h5>
            <div id="about-sections" class="about-sections">
                <% for(let i =0 ; i<club.about.length; i++){ %>                
                <div class="about-section">
                    <label for="about-title-<%= i %>" class="form-label">About Title</label>
                    <input type="text" name="club[about][<%= i %>][title]" value="<%= club.about[i].title %>" id="about-title-<%= i %>" class="form-control"
                        placeholder="Enter about title" required>
                    <label for="about-desc-<%= i %>" class="form-label">About Description</label>
                    <textarea name="club[about][<%= i %>][desc]" id="about-desc-<%= i %>" class="form-control"
                        placeholder="Enter about description" required><%= club.about[i].desc %></textarea>
                    <button type="button" class="btn btn-danger remove-about-btn mt-2">Remove</button>
                </div>
                <% } %>
            </div>
            <button type="button" class="btn btn-secondary mt-3" id="add-about-btn">Add About Section</button>
            <hr class="mt-4">
            <h5>Coordinator Section</h5>
            <div id="coordinator-sections" class="coordinator-sections">
                <% for(let i =0 ; i<club.coordinators.length; i++){ %>  
                <div class="coordinator-section mt-3">
                    <div class="coord-img">
                        <img src="<%= club.coordinators[i].img.url %>" alt="">
                    </div>
                    <label for="coordinator-name-<%= i %>" class="form-label">Coordinator Name</label>
                    <input type="text" name="club[coordinators][<%= i %>][name]" id="coordinator-name-<%= i %>" class="form-control" placeholder="Coordinator Name" value="<%= club.coordinators[i].name %>" required>
                    <label for="coordinator-rollNo-<%= i %>" class="form-label">Coordinator Roll No</label>
                    <input type="text" name="club[coordinators][<%= i %>][rollNo]" id="coordinator-rollNo-<%= i %>" class="form-control" placeholder="Coordinator Roll No" value="<%= club.coordinators[i].rollNo %>" required>
                    <label for="coordinator-img-<%= i %>" class="form-label">Update Image</label>
                    <input type="file" name="club[coordinators][<%= i %>][img]" id="coordinator-img-<%= i %>" class="form-control">
                    <button type="button" class="btn btn-danger mt-2 remove-coordinator-btn">Remove</button>
                </div>
                <% } %>
            </div>
            <button type="button" class="btn btn-secondary mt-3" id="add-coordinator-btn">Add Coordinator</button>
            </div>
            <button class="btn btn-success mt-3">Update Club</button>
            <br><br>
        </form>
    </div>
</div>

<script>
    function updateAboutSectionIds() {
            const aboutSections = document.querySelectorAll('.about-section');
            aboutSections.forEach((section, index) => {
                section.querySelector('.form-label[for^="about-title"]').setAttribute('for', `about-title-${index}`);
                section.querySelector('.form-control[id^="about-title"]').setAttribute('id', `about-title-${index}`);
                section.querySelector('.form-control[name^="club[about]"][name$="[title]"]').setAttribute('name', `club[about][${index}][title]`);
                
                section.querySelector('.form-label[for^="about-desc"]').setAttribute('for', `about-desc-${index}`);
                section.querySelector('.form-control[id^="about-desc"]').setAttribute('id', `about-desc-${index}`);
                section.querySelector('.form-control[name^="club[about]"][name$="[desc]"]').setAttribute('name', `club[about][${index}][desc]`);
            });
        }
        function updateCoordinatorSectionIds() {
            const coordinatorSections = document.querySelectorAll('.coordinator-section');
            coordinatorSections.forEach((section, index) => {
                section.querySelector('.form-label[for^="coordinator-name"]').setAttribute('for', `coordinator-name-${index}`);
                section.querySelector('.form-control[id^="coordinator-name"]').setAttribute('id', `coordinator-name-${index}`);
                section.querySelector('.form-control[name^="club[coordinators]"][name$="[name]"]').setAttribute('name', `club[coordinators][${index}][name]`);
                
                section.querySelector('.form-label[for^="coordinator-rollNo"]').setAttribute('for', `coordinator-rollNo-${index}`);
                section.querySelector('.form-control[id^="coordinator-rollNo"]').setAttribute('id', `coordinator-rollNo-${index}`);
                section.querySelector('.form-control[name^="club[coordinators]"][name$="[rollNo]"]').setAttribute('name', `club[coordinators][${index}][rollNo]`);

                section.querySelector('.form-label[for^="coordinator-img"]').setAttribute('for', `coordinator-img-${index}`);
                section.querySelector('.form-control[id^="coordinator-img"]').setAttribute('id', `coordinator-img-${index}`);
                section.querySelector('.form-control[name^="club[coordinators]"][name$="[img]"]').setAttribute('name', `club[coordinators][${index}][img]`);
    });
}


    document.addEventListener('DOMContentLoaded', function () {
        let aboutSectionCount = 1;
        let coordinatorSectionCount = 1;
        document.getElementById('add-about-btn').addEventListener('click', function () {
            const aboutSections = document.getElementById('about-sections');
            const newSection = document.createElement('div');
            newSection.classList.add('about-section', 'mb-3');
            newSection.innerHTML = `
            <label for="about-title-${aboutSectionCount}" class="form-label">About Title</label>
            <input type="text" name="club[about][${aboutSectionCount}][title]" id="about-title-${aboutSectionCount}" class="form-control" placeholder="Enter about title" required>
            <label for="about-desc-${aboutSectionCount}" class="form-label">About Description</label>
            <textarea name="club[about][${aboutSectionCount}][desc]" id="about-desc-${aboutSectionCount}" class="form-control" placeholder="Enter about description" required></textarea>
            <button type="button" class="btn btn-danger mt-2 remove-about-btn">Remove</button>
        `;
            aboutSections.appendChild(newSection);
            aboutSectionCount++;
            updateAboutSectionIds();
        });

        document.getElementById('about-sections').addEventListener('click', function (event) {
            if (event.target.classList.contains('remove-about-btn')) {
                event.target.parentElement.remove();
                updateAboutSectionIds();
            }
        });

        document.getElementById('add-coordinator-btn').addEventListener('click', function () {
            const coordinatorSections = document.getElementById('coordinator-sections');
            const newSection = document.createElement('div');
            newSection.classList.add('coordinator-section', 'mb-3');
            newSection.innerHTML = `
                <label for="coordinator-name-${coordinatorSectionCount}" class="form-label">Coordinator Name</label>
                <input type="text" name="club[coordinators][${coordinatorSectionCount}][name]" id="coordinator-name-${coordinatorSectionCount}" class="form-control" placeholder="Coordinator Name" required>
                <label for="coordinator-rollNo-${coordinatorSectionCount}" class="form-label">Coordinator Roll No</label>
                <input type="text" name="club[coordinators][${coordinatorSectionCount}][rollNo]" id="coordinator-rollNo-${coordinatorSectionCount}" class="form-control" placeholder="Coordinator Roll No" required>
                <label for="coordinator-img-${coordinatorSectionCount}" class="form-label">Update Image</label>
                <input type="file" name="club[coordinators][${coordinatorSectionCount}][img]" id="coordinator-img-${coordinatorSectionCount}" class="form-control" required>
                <button type="button" class="btn btn-danger mt-2 remove-coordinator-btn">Remove</button>
            `;
            coordinatorSections.appendChild(newSection);
            coordinatorSectionCount++;
            updateCoordinatorSectionIds();
        });

        document.getElementById('coordinator-sections').addEventListener('click', function (event) {
            if (event.target.classList.contains('remove-coordinator-btn')) {
                event.target.parentElement.remove();
                updateCoordinatorSectionIds();
            }
        });
    });
</script>